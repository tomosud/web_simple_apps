# 音ゲー制作仕様書（PLAN.md）

## 🎯 プロジェクト完成

**ステータス**: 完成
**完成度**: 100%

---

# 🎮 ゲームプレイヤー向け情報

## ゲーム概要

**「お金を使えば使うほど、人間が大きくなる。今月もがんばろう！」**

東京で生きる普通のサラリーマンの日常を、音楽ゲームで体験するシミュレーション作品です。朝7時30分の改札から始まる一日、コンビニでの小さな買い物、電車の往復、母親からの温かい振込——日々の消費行動の中にある、愛と孤独と希望を描いた現代的な音楽体験です。

### 🎵 音楽と歌詞について

ステージ3から流れる楽曲は、東京で働く人々の心の声を歌ったオリジナル楽曲。レシートに刻まれる数字の向こう側にある、本当の感情を歌詞に込めました。改札を通る音、コンビニの明かり、スマートフォンの通知音——現代都市生活のサウンドスケープと共に、一人の人間の物語が展開されます。

### 🎮 ゲームシステム

#### 基本システム
- **初期資金**: 30,000円（今月の生活費）
- **4レーン制**: PayPay、Suica、ファミリーマート、LINEでの消費体験
- **リアルな価格**: 実際の商品価格データによる本格的な支出シミュレーション
- **ライフシステム**: 4つのハート。生活の厳しさを表現
- **ステージ制**: 30秒ごとに進む「X日目」のサイクル

#### 操作方法
- **タップ**: ブランドロゴが判定ラインに来たタイミングでタップ
- **成功**: リアルな決済音と共に、商品価格が生活費から差し引かれる
- **失敗**: ライフが減少。生活の厳しさを実感

#### 特別演出
- **ステージ3**: 「AIが歌います。」— 音楽と歌詞字幕が始まる特別な瞬間
- **歌詞字幕**: 楽曲に込められた想いを、リアルタイムで体験

### 🌆 テーマ性

この作品は、現代の都市生活者が抱える普遍的な体験を音楽ゲームに落とし込んだものです。

- **消費と愛情**: お金の取引の向こう側にある、人とのつながり
- **都市の孤独**: 800万人が住む東京で、一人でいることの意味
- **日常の詩情**: コンビニ弁当や電車賃にも宿る、小さなドラマ
- **母親の愛**: 振込通知に込められた、変わらない愛情
- **存在証明**: レシートという記録に刻まれた、「僕がここにいた」証拠

### 🎶 楽曲の背景

楽曲「7:30 through the ticket gate」は、朝の改札から始まる一日の物語。歌詞には実際のサラリーマンの支出パターンが織り込まれており、ゲームプレイと歌詞が完全にシンクロする設計となっています。

- **言語**: 日本語と英語が自然に混在（現代東京の言語環境を反映）
- **具体性**: 「ツナマヨおにぎり minus 128円」など、リアルな価格表示
- **感情**: 数字では表現できない、日常の中の温かさと寂しさ

---

# 🛠️ 実装の経緯

## プロジェクト背景

### 開発手法: 100% AIコーディング
このプロジェクトは、人間のディレクションとAIの協働による100%AIコーディングで実現されました。

- **コーディング**: Claude（Anthropic）が全コードを生成
- **ディレクション**: 人間が仕様策定・品質管理・デザイン判断
- **開発時間**: 約10時間（企画から完成まで）

### データ作成プロセス
- **商品価格データ**: 人間とLLMの協働でCSVデータ生成
- **フレーバーテキスト**: AIが量産、人間が選択・調整
- **音楽制作**: 歌詞を人間とLLMで共作 → Sunoで楽曲生成（https://suno.com/）
- **字幕データ**: WebVTT形式で楽曲と完全同期

## 技術仕様

### アーキテクチャ
- **3Dエンジン**: Three.js r128による本格的な3D音楽ゲーム
- **音響システム**: Web Audio API + HTML5 Audio のハイブリッド構成
- **データ駆動**: CSV形式による価格データの動的読み込み
- **入力処理**: 3D座標投影による精密なタッチ判定
- **レスポンシブ**: PC・スマートフォン完全対応

### ファイル構成
```
otoge/
├── index.html              # メインHTML
├── css/
│   └── style.css          # レスポンシブスタイル
├── js/
│   ├── main.js            # ゲーム初期化・メインループ (98行)
│   ├── scene.js           # Three.js 3Dシーン・テクスチャ管理 (387行)
│   ├── gameLogic.js       # ゲームロジック・UI更新・AI歌唱制御 (399行)
│   ├── costManager.js     # CSV価格データ管理・ランダム選択 (248行)
│   ├── inputHandler.js    # 3D座標投影による精密入力処理 (356行)
│   ├── soundManager.js    # Web Audio API・音楽再生管理 (387行)
│   └── subtitleManager.js # WebVTT字幕表示システム (394行)
├── assets/
│   ├── cost/              # 価格データ（CSV）
│   │   ├── config.json    # ブランド別選択ルール
│   │   ├── famima.csv     # ファミリーマート商品価格（95件）
│   │   ├── line.csv       # LINE関連サービス価格
│   │   ├── peypey.csv     # PayPay決済商品価格
│   │   └── suica.csv      # Suica決済商品価格
│   ├── textures/          # テクスチャファイル
│   │   ├── famima.png     # ファミリーマートロゴ（128x128）
│   │   ├── line.png       # LINEロゴ（128x128）
│   │   ├── peypey.png     # PayPayロゴ（128x128）
│   │   ├── suica.png      # Suicaロゴ（128x128）
│   │   └── grad.png       # グラデーションテクスチャ
│   ├── music/             # 音楽ファイル
│   │   └── 7_30 through the ticket gateB.mp3  # Suno生成楽曲
│   ├── vtt/               # 字幕ファイル
│   │   └── 7_30 through the ticket gateB.vtt  # 歌詞字幕データ
│   └── sounds/            # ブランド別効果音
└── run.bat               # ローカルサーバー起動バッチ
```

## 開発段階

### ✅ 完成済み機能（全段階完了）

1. **基本3D環境構築** - Three.js 4レーン環境
2. **ノート生成・移動システム** - 3D物理演算
3. **入力・判定システム** - タッチ・マウス対応
4. **サウンドシステム** - Web Audio API
5. **ゲームループ・UI** - 30秒ステージ制
6. **スマートフォン対応** - レスポンシブ
7. **ブランドテクスチャ・サウンド** - PayPay・Suica・ファミマ・LINE
8. **ライフシステム** - 4ハート制
9. **リアルマネースコアシステム** - CSV価格データ統合
10. **AI歌唱システム** - ステージ3特別演出
11. **UI/UX最適化** - 視覚的改善・操作性向上
12. **安定性向上** - バグ修正・制御強化
13. **ミスタップペナルティシステム** - エリア外タップ検知・ペナルティ効果
14. **歌詞字幕表示システム** - WebVTT連動による完全同期字幕
15. **動的フォントサイズ調整システム** - 縦画面基準による字幕サイズ最適化

### 実装完了機能詳細

#### 🎮 コアゲームシステム
- **4レーン音楽ゲーム**: Three.js 3D環境での音楽ゲーム
- **リアルマネーシミュレーション**: 30,000円の今月の生活費から開始
- **ブランド連動**: PayPay・Suica・ファミリーマート・LINEの4ブランド対応
- **ライフシステム**: 4つのハート表示、ノートを逃すかミスタップでライフ減少
- **ミスタップペナルティ**: エリア外タップで警告音・ライフ点滅・背景フラッシュ
- **ステージ制**: 30秒ごとにステージ進行、難易度上昇

#### 🎵 音楽・字幕システム
- **ステージ3特別演出**: 「AIが歌います。」の大画面表示
- **MP3音楽再生**: Suno生成楽曲の自動リピート再生
- **音楽制御**: ゲームオーバー時の停止、予期しない停止時の自動再開
- **歌詞字幕表示**: WebVTT形式による楽曲と完全同期した字幕システム
- **YouTube風UI**: 画面下部に黒背景・白文字の字幕表示
- **動的フォントサイズ**: 縦画面高さ基準でスマホ・PC両対応の字幕サイズ自動調整

#### 💰 価格表示システム
- **リアルタイム価格表示**: CSV から読み込んだ実際の商品価格を表示
- **色分け表示**: マイナス価格（赤）、プラス価格（青）、0円（グレー）
- **CSV解析**: 商品名にカンマが含まれる場合の正しい解析

#### 🎨 UI/UX
- **視覚的改善**: 判定エリアグレー化、10%縮小、白い淵除去
- **グラデーションテクスチャ**: レーンに適用された奥行き表現
- **フレームレス**: スコア表示・タイマーの枠線除去
- **レスポンシブ対応**: PC・スマートフォン完全対応

#### 🔧 技術的特徴
- **ステージ遷移制御**: 遷移中のクリック入力無効化
- **音楽安定性**: リピート再生と予期しない停止時の自動再開
- **ゲームバランス**: ゲームオーバー後の適切なリセット処理
- **CORS対応**: ローカルサーバーによる開発環境

## 開発ルール（遵守済み）

1. ✅ 他フォルダへの影響を与えない
2. ✅ 各ファイルは400行以下を厳守
3. ✅ コードは可読性を重視  
4. ✅ GitHub Pages 対応（静的ファイル）
5. ✅ エラーハンドリングを適切に実装

## プロジェクトの到達点

**技術的成果**:
- Three.js による3D音楽ゲーム
- Web Audio API + HTML5 Audio のハイブリッド音響システム  
- CSV データ駆動の動的価格表示システム
- 3D座標投影による精密タッチ判定
- WebVTT による楽曲同期字幕システム
- レスポンシブデザイン完全対応
- 動的フォント調整による縦画面基準表示システム

**芸術的成果**:
- 現代都市生活をテーマにした音楽ゲーム
- 日本語・英語混在による現代的な歌詞表現
- リアルな商品価格データによる社会性
- AI生成楽曲との完璧な同期システム

**開発手法の成果**:
- 100% AIコーディングによる高品質ゲーム開発の実証
- 約10時間での企画から完成までの高速開発
- 人間・AI協働による創作プロセスの確立

---

**現在のステータス**: **完成** - 全機能実装完了、安定動作確認済み
