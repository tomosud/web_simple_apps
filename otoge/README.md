# 音ゲー（otoge）

## 概要
「お金を使えば使うほど、人間が大きくなる」をテーマにした現実的な支出シミュレーション音楽ゲームです。
プレイヤーは今月の生活費30,000円から始まり、PayPay、Suica、ファミリーマート、LINEの4つのブランドでの消費を体験します。

## ゲームシステム
- **初期資金**: 30,000円（今月の生活費）
- **4レーン制**: 各レーンにブランド（PayPay、Suica、ファミリーマート、LINE）が割り当て
- **リアルな価格データ**: CSVファイルから実際の商品価格を読み込み
- **ライフシステム**: 4つのハート、ノートを逃すかミスタップでライフ減少
- **ミスタップペナルティ**: エリア外タップで嫌な音＋ライフ点滅＋背景赤フラッシュ
- **ステージ制**: 30秒ごとにステージが進行（X日目として表示）

## 開発ルール
このフォルダ以下で実装し、コーディングするAIは他フォルダを更新しないこと。

Github pageに静的にhostできる技術で作成する事。
スマホでの実行を可能とすること
関数のファイルは約４００行までを限度とし、それ以上になりそうな場合は計画的にファイルを分割する事。

各ゲームのフォルダ以下にREADME.mdを作成し、仕様と実装計画を最新にしながら実装する事。

## 技術仕様
- **3Dエンジン**: Three.js r128
- **サウンド**: Web Audio API + ブランド別音声ファイル
- **データ管理**: CSV形式で商品価格データを管理
- **UI**: CSS animations、レスポンシブデザイン
- **入力**: タッチ・マウス対応、3D座標投影による精密な判定

## ファイル構成
```
otoge/
├── index.html              # メインHTML
├── css/
│   └── style.css          # スタイルシート
├── js/
│   ├── main.js            # ゲーム初期化・メインループ
│   ├── scene.js           # Three.js 3Dシーン管理
│   ├── gameLogic.js       # ゲームロジック・UI更新
│   ├── costManager.js     # CSV価格データ管理
│   ├── inputHandler.js    # 入力ハンドリング
│   └── soundManager.js    # サウンド管理
├── assets/
│   ├── cost/              # 価格データ（CSV）
│   │   ├── config.json    # 選択ルール設定
│   │   ├── famima.csv     # ファミリーマート商品
│   │   ├── line.csv       # LINE商品
│   │   ├── peypey.csv     # PayPay商品
│   │   └── suica.csv      # Suica商品
│   ├── textures/          # テクスチャファイル
│   │   ├── famima.png     # ファミリーマートロゴ
│   │   ├── line.png       # LINEロゴ
│   │   ├── peypey.png     # PayPayロゴ
│   │   ├── suica.png      # Suicaロゴ
│   │   └── grad.png       # グラデーションテクスチャ
│   └── sounds/            # 音声ファイル
└── run.bat               # ローカルサーバー起動
```

## 最近の更新履歴
1. **UI改善**: 枠線削除、価格表示位置調整、タイマーに「秒」単位追加
2. **CSV解析修正**: 商品名にカンマが含まれる場合の正しい解析
3. **判定エリア調整**: 幅10%縮小、緑色からグレーに変更、白い淵を除去
4. **テキスト変更**: 
   - ゲームタイトル: 「お金を使えば使うほど、人間が大きくなる。今月もがんばろう！」
   - 残金 → 今月の生活費
   - もう一度プレイ → もう一度人生をプレイ
   - ステージ → ステージX日目
5. **AI歌唱機能**: ステージ3で「AIが歌います。」表示後、MP3音楽をリピート再生
6. **価格表示改善**: プラス価格は青字、0円はマイナス記号なし、マイナス価格は赤字
7. **音楽制御強化**: 
   - ゲームオーバー後のリスタート時に音楽停止
   - 音楽の予期しない停止時の自動再開機能
8. **ゲームバランス調整**:
   - ゲームオーバー後のリスタートでノートスピードと間隔を初期値にリセット
   - ステージ数の正しい管理（通常時は増加、ゲームオーバー時のみリセット）
9. **ステージ遷移時クリック問題修正（2024年12月）**:
   - ステージ表示中のダブルクリックでゲームがリスタートされる問題を修正
   - ステージ表示要素に`pointer-events: none`を追加してクリック透過を実現
   - より安定したステージ進行を実現
10. **デバッグログ最適化**:
   - 不要なサウンド・価格表示ログを無効化
   - クリーンな実行環境を提供
11. **ミスタップペナルティシステム実装（2024年12月）**:
   - エリア外タップでライフ減少とペナルティ効果
   - ライフアイコンの点滅アニメーション（3回点滅）
   - 背景の赤色フラッシュエフェクト（200ms）
   - より大きく低音の不快なミスタップサウンド
   - スタート・リスタートボタンへの影響なし

## 実装完了機能
- ✅ 4レーン3D音楽ゲーム基盤
- ✅ リアルタイム価格データ表示システム
- ✅ ブランド別サウンド・テクスチャシステム
- ✅ タッチ・マウス入力対応
- ✅ ライフ・ステージシステム（ミスタップペナルティ含む）
- ✅ レスポンシブUI設計
- ✅ CORS対応ローカルサーバー

## 開発状況
**完成度**: 99%以上
基本的なゲームシステムは完成済み。ミスタップペナルティシステムも実装完了し、より完成度の高いゲーム体験を提供。