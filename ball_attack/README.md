# Ball Attack - 地球シューティングゲーム用カメラシステム

## 概要
Three.jsを使用した地球シューティングゲームのカメラ制御システム。プレイヤーは地球をトラックボールのようにドラッグで回転させ、地球上の敵を狙い撃つゲームです。実装では地球が固定され、カメラ側が動くことでトラックボール操作を再現しています。

## システム仕様

### 基本コンセプト
- **ゲーム目標**: 地球をトラックボールのように操作し、地球上の敵を撃つシューティングゲーム
- **実装方式**: 地球は画面中央に固定、カメラ側が動いてトラックボール操作を再現
- **軌道球システム**: 見えない軌道球を作成し、カメラを親子付けすることで制御
- **人工衛星モード**: デバッグ用に人工衛星（緑色の円錐）を表示し、動きを確認できる

### プレイヤー操作

#### トラックボール操作（カメラ回転）
- **ドラッグ**: 地球をトラックボールのように回転（実際はカメラが動く）
- **クリック**: 回転速度を減衰させて停止
- **慣性システム**: ドラッグ終了後も慣性で回転し続け、徐々に停止
- **重い石玉のような動き**: 質量100.0で重く、動き始めは遅く、一度動けば永続的
- **等速度運動**: 高速時は摩擦なしで永続的に動き続ける
- **低速域摩擦**: 速度0.005以下で自然な停止

#### ズーム制御（軌道半径変更）
- **PC**: マウスホイールで地球から遠ざかる/近づく（3倍速高速対応）
- **スマホ**: ピンチジェスチャ（2本指）で軌道半径変更
- **慣性システム**: 質量20.0、摩擦0.9で滑らかな半径変更
- **制限**: 最小半径1.1～最大半径3.0

#### 物理パラメータ調整UI
- **摩擦強度**: 0.01～0.3（リアルタイム調整）
- **質量**: 10～200（重い動きの調整）
- **基本摩擦**: 0.90～0.99（減衰の調整）

#### 武器パラメータ調整UI
- **攻撃範囲**: 0.02～0.2（現在0.095、リアルタイム調整）
- **散らばり**: 0.01～0.2（現在0.05、着弾散らばり係数）

#### 慣性システム詳細
- **物理モデル**: 重い石玉を転がすような動き
- **速度依存制御**: 動いている時は加速しやすく、止まっている時は重く
- **二段階摩擦**: 高速時は等速度運動、低速時は摩擦で停止
- **直感的操作**: カメラ座標系ベースのスクリーンスペース固定操作

### 技術仕様

#### 軌道球システム詳細
- **軌道球（orbitSphere）**: 見えない制御用オブジェクト、地球中心に配置
- **人工衛星**: 軌道球の子、デバッグ用表示
- **カメラマウント**: 軌道球の子、カメラ位置制御用
- **親子関係**: 軌道球の回転により全体が同期回転

#### 物理システム
- **クォータニオンベース**: ジンバルロック回避で滑らかな回転
- **速度依存制御**: 止まっている時は動きにくく、動いている時は加速しやすい
- **慣性システム**: 質量100、低速域摩擦0.95、高速域は等速度運動
- **軌道半径慣性**: 質量20、摩擦0.9で滑らかなズーム
- **カメラ座標系ベース**: スクリーンスペース固定の直感的操作

#### 使用技術
- **レンダリング**: Three.js、WebGL、アンチエイリアス有効
- **地球描画**: SphereGeometry + 高解像度地形テクスチャ（5400x2700）
- **人工衛星**: ConeGeometry（緑色の円錐、デバッグ用）
- **軌道制御**: クォータニオンベースの軌道球制御システム
- **姿勢制御**: カメラ座標系ベースでジンバルロック回避

#### ファイル構成
```
ball_attack/
├── index.html          # メインHTML + 物理・武器パラメータUI
├── js/
│   ├── main.js         # BallAttackGameクラス、軌道球システム、ゲーム統合
│   ├── controls.js     # SatelliteOrbitControlsクラス、慣性システム、カメラ制御
│   ├── weapons.js      # WeaponSystemクラス、弾丸・攻撃判定・エフェクト
│   ├── enemies.js      # EnemySystemクラス、敵配置・衝突判定・撃破エフェクト
│   ├── sound.js        # SoundSystemクラス、連番サウンド自動検出・ランダム再生
│   └── utils.js        # ユーティリティ関数、パフォーマンス監視
├── assets/
│   ├── world.topo.bathy.200412.3x5400x2700.jpg  # 高解像度地球テクスチャ
│   └── sound/          # サウンドファイル（Canon01-02, impact01-02, hit01-02）
└── css/
    └── style.css       # レスポンシブスタイル、タッチ操作最適化
```

#### レスポンシブ対応
- スマートフォン・タブレット・PC対応
- タッチ操作（ピンチジェスチャ）とマウス操作の両方サポート
- 画面サイズに応じたUI調整

### 操作ガイド

#### 基本操作
- **ドラッグ**: 軌道上での移動（スクリーンスペース固定の直感的操作）
- **クリック**: 速度を減衰（動きを止めたい時）
- **マウスホイール**: 軌道半径変更（地球に近づく/遠ざかる、高速）
- **ピンチ**: スマホでの軌道半径変更

#### キーボードショートカット
- **F**: 人工衛星位置リセット
- **D**: デバッグモード切り替え
- **R**: ゲームリセット
- **スペースキー**: 弾丸発射（PC用）
- **W**: ワイヤーフレーム範囲表示切り替え（攻撃範囲確認用）

#### 物理挙動の特徴
- **動き始め**: 重く、反応が鈍い（静止時は特に重い）
- **高速時**: 等速度運動で止まりにくい
- **低速時**: 自動的に摩擦が働いて停止
- **ズーム**: 慣性のある滑らかな半径変更（高速化）
- **操作方向**: どの角度でも一貫したスクリーンスペース操作
- **モード別操作**: 人工衛星モード（上下調整）、カメラモード（左右調整）

### 実装完了内容

#### Phase 1: 軌道球カメラシステム ✅
- **基本3Dシーン**: Three.jsシーン、カメラ、レンダラー、ライティング
- **地球オブジェクト**: 固定位置、高解像度テクスチャ（5400x2700）
- **軌道球システム**: 見えない制御用オブジェクト、親子関係でカメラ制御
- **モード切り替え**: デバッグモード（人工衛星表示）とカメラモード

#### Phase 2: 慣性システム ✅
- **重い石玉のような動き**: 質量100.0で重く、動き始めは遅い
- **等速度運動**: 高速時は摩擦なしで永続的な動き
- **低速域摩擦**: 速度0.005以下で自動停止システム
- **速度依存制御**: 動いている時は加速しやすい、止まっている時は重い

#### Phase 3: カメラ制御システム ✅
- **カメラ座標系ベース**: スクリーンスペース固定の直感的操作
- **ジンバルロック回避**: クォータニオンベースの回転制御
- **制限なし移動**: 極地を含む全方向へ自由移動
- **モード別入力切り替え**: デバッグ/カメラモードで最適化

#### Phase 4: ズーム制御システム ✅
- **マウスホイール**: PC用、3倍速高速対応
- **ピンチジェスチャ**: スマホ用、タッチ操作最適化
- **軌道半径慣性**: 質量20.0、摩擦0.9で滑らかな半径変更
- **範囲制限**: 1.1～3.0の軌道半径

#### Phase 5: 操作性改善 ✅
- **クリック減速**: 直感的な停止操作
- **物理パラメータUI**: リアルタイム調整可能
- **タッチ操作最適化**: passive: false、ピンチジェスチャ対応
- **レスポンシブデザイン**: スマホ・タブレット・PC対応

#### Phase 6: 攻撃システム ✅
- **人工衛星ベース発射**: 衛星位置から地球への攻撃
- **左右交互発射**: 0.15秒間隔で両側の銃から交互発射
- **リアルな弾道**: 個別ランダム振動によるアンチエアクラフト砲風軌道
- **パーティクル爆発**: 地表衝突時の粒子エフェクト
- **ポイントライト点灯**: 爆発時の照明エフェクト（最大3個同時）
- **攻撃判定システム**: 全着弾位置に判定球生成、中心100%・境界20%の線形ダメージ
- **ワイヤーフレーム範囲表示**: 攻撃範囲の可視化（Wキーで切り替え）
- **オブジェクトプール**: 弾丸・パーティクル・ライト・判定球の効率的管理

#### Phase 7: サウンドシステム ✅
- **発射音システム**: Canon01.wav, Canon02.wavをランダム再生
- **爆発音システム**: impact01.wav, impact02.wavを地表衝突時にランダム再生
- **敵撃破音システム**: hit01.wav, hit02.wavを敵撃破時にランダム再生
- **連番サウンド自動検出**: 連番ファイル（01, 02...）を自動検出・ランダム使用
- **音量制御**: 全体音量係数による音量調整機能
- **同時再生制限**: 最大64個の音の同時再生でパフォーマンス最適化

**技術的特徴**:
- **軌道球システム**: 親子関係による滑らかなカメラ制御
- **ジンバルロック回避**: クォータニオンベースの安定した回転制御
- **重い石玉モデル**: 質量100.0で自然な慣性と重さを再現
- **スクリーンスペース固定**: カメラ座標系ベースの直感的操作
- **二段階摩擦システム**: 高速時は等速度、低速時は自動停止
- **モード切り替え**: デバッグ用人工衛星表示とカメラモード
- **マルチプラットフォーム**: PC・Spb・タブレット対応

## 次の実装予定

### 攻撃ゲームフェーズ1: 静的ターゲットシステム ✅
地球表面に配置された300個の赤い敵を攻撃するシューティングゲームの実装

#### 実装完了内容 ✅
1. **敵配置システム**: 地球表面に300個の赤いスフィア配置（重複回避）
2. **衝突判定システム**: 攻撃判定球と敵の3D衝突判定・確率的撃破処理
3. **ゲーム進行システム**: リアルタイムスコア・敵数表示・全敵撃破判定
4. **敵撃破エフェクト**: 赤い大型パーティクル・攻撃範囲2倍の赤いライト・撃破アニメーション

#### 将来の拡張予定
- **フェーズ2**: 地球上を移動する動的な敵システム
- **フェーズ3**: 敵の増殖・AI・多様な敵種別・ウェーブシステム

#### 技術的基盤
- **完成したカメラシステム**: ジンバルロックなし、制限なし移動
- **安定した攻撃システム**: 弾丸発射、爆発エフェクト、攻撃判定完備
- **サウンドシステム**: 発射音・爆発音対応済み
- **マルチプラットフォーム対応**: PC・スマホ・タブレット全対応

**詳細な実装計画**: `PLAN.md` を参照  
**完了済み履歴**: `HISTORY.md` を参照

## 動作環境
- **ブラウザ**: モダンブラウザ（Chrome, Firefox, Safari, Edge）
- **技術要件**: WebGL対応必須
- **プラットフォーム**: PC・スマートフォン・タブレット対応
- **ホスティング**: GitHub Pages での静的ホスティング
- **パフォーマンス**: 60fps目標、軽量設計