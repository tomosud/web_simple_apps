# Ball Attack

## 概要
Three.jsを使用した3Dシューティングゲーム。プレイヤーは地球をトラックボールのように回転させ、地球表面を動き回る敵の点群を自動発射される弾で撃墜するゲームです。

## ゲーム仕様

### 基本コンセプト
- 地球は画面中央に固定配置
- プレイヤーは地球をドラッグで回転操作
- 弾は自動で画面両側から中央奥に向かって連続発射
- 地球表面を移動する敵の点群を撃墜することが目的

### プレイヤー操作
- **地球回転**: マウスドラッグまたはタッチスワイプで地球を回転
- **慣性**: ドラッグ終了後も慣性で地球が回転し続け、徐々に停止
- **ズーム**: 
  - PC: マウスホイールスクロール
  - スマホ: ピンチジェスチャー（2本指スワイプ）
- プレイヤーは弾の発射をコントロールできない（自動発射のみ）

### ゲーム要素

#### 地球
- 中央に固定された3D球体
- テクスチャ: `assets/eo_base_2020_clean_720x360.jpg`
- リアルタイムで滑らかに回転
- ドラッグ慣性システム搭載

#### 弾システム
- 画面左右から中央奥（地球方向）に向かって自動発射
- 一定間隔での連続発射
- 地球表面の敵に当たると消滅
- 地球を貫通しない（地球で停止）

#### 敵（点群）
- 地球表面上を移動する点状の敵
- ランダムまたは一定パターンで移動
- 弾に当たると撃墜される
- 一定数を撃墜するとスコア獲得

### 技術仕様

#### 使用技術
- **レンダリング**: Three.js (r128)
- **地球描画**: SphereGeometry + TextureLoader
- **点群描画**: インスタンス化レンダリング（InstancedMesh）
- **操作**: OrbitControls をベースにカスタマイズ
- **パフォーマンス**: LOD、フラスタムカリング、オブジェクトプール

#### ファイル構成
```
ball_attack/
├── index.html          # メインHTML
├── js/
│   ├── main.js         # ゲームメインロジック
│   ├── controls.js     # 地球回転・ズーム制御
│   ├── weapons.js      # 弾システム
│   ├── enemies.js      # 敵システム
│   ├── collision.js    # 当たり判定
│   └── utils.js        # ユーティリティ
├── assets/
│   └── eo_base_2020_clean_720x360.jpg  # 地球テクスチャ
└── css/
    └── style.css       # スタイル
```

#### レスポンシブ対応
- スマートフォン・タブレット・PC対応
- タッチ操作とマウス操作の両方サポート
- 画面サイズに応じたUI調整
- GitHub Pages で静的ホスティング対応

### ベースコード参照
- `sample/` フォルダの実装をベースとする
- 特に以下の技術を流用:
  - Three.js セットアップ（main.js）
  - インスタンス化レンダリング（instanced-rendering.js）
  - パフォーマンス最適化（performance.js）
  - エフェクトシステム（effects.js）
  - 地球テクスチャのUVマッピング手法

## 開発フェーズ
1. **Phase 1**: 基本的な地球表示と回転システム ✅ **完了**
2. **Phase 2**: 敵の点群システム実装
3. **Phase 3**: 弾システムと自動発射
4. **Phase 4**: 当たり判定とゲームロジック
5. **Phase 5**: UI・スコア・ゲームオーバー処理
6. **Phase 6**: エフェクト・サウンド・最適化

### Phase 1 実装完了内容
- Three.jsシーンとレンダラーの基本セットアップ
- 地球オブジェクト（SphereGeometry + 高解像度地形テクスチャ）
- **地球固定・カメラ軌道移動システム**（従来の地球回転方式から変更）
- **超重い石の物理挙動**（動き始めにくく、慣性で長時間回転継続）
- **スクリーンスペースの直感的な操作**（ジンバルロック問題を根本解決）
- 球面座標系による安定したカメラ制御
- レスポンシブキャンバス対応
- 基本的なUI表示
- パフォーマンス監視システム
- キーボードショートカット（F: 視点リセット、D: デバッグ、R: ゲームリセット）

**技術的改善点**:
- 地球回転→カメラ軌道移動により操作の安定性向上
- 球面座標系でのジンバルロック問題軽減
- 物理パラメータ調整で重厚な操作感を実現
- テクスチャを高解像度地形データに変更

**カメラ制御システムの改善** (最新):
- **二重符号反転問題を修正**: 縦回転が直感的な方向に動作
- **スマホタッチ操作対応**: passive: falseオプション、独立したタッチイベント処理
- **極地回転継続処理**: 北極・南極通過時の180度回転で連続回転を実現
- **数値安定性向上**: 極地での回転停止問題を大幅軽減
- **レスポンシブタッチ**: touch-action: none、user-select: noneでタッチ操作最適化

## 動作環境
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- WebGL対応必須
- スマートフォン・タブレット対応
- GitHub Pages での静的ホスティング
