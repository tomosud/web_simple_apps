# Ball Attack - 人工衛星軌道制御システム

## 概要
Three.jsを使用した3D人工衛星軌道制御システム。プレイヤーは人工衛星をドラッグで軌道上を移動させ、マウスホイールやピンチジェスチャで軌道半径を変更できます。

## システム仕様

### 基本コンセプト
- 地球は画面中央に固定配置
- カメラは地球にフィットした固定位置
- 人工衛星（緑色の円錐）が地球軌道上に配置
- 人工衛星は常に地球の中心を向いている

### プレイヤー操作

#### 軌道移動
- **ドラッグ**: 人工衛星を軌道上で移動（左右・上下区別なく全方向）
- **クリック**: 人工衛星の速度を減衰させて停止
- **慣性システム**: ドラッグ終了後も慣性で移動し続け、徐々に停止
- **等速度運動**: 高速時は摩擦なしで永続的に動き続ける
- **低速域摩擦**: 一定速度以下で自然に停止

#### 軌道半径制御（ズーム）
- **PC**: マウスホイールで地球から遠ざかる/近づく
- **スマホ**: ピンチジェスチャ（2本指）で軌道半径変更
- **慣性システム**: 滑らかで物理的な半径変更
- **制限**: 最小半径1.1～最大半径3.0

#### 物理パラメータ調整UI
- **摩擦強度**: 0.01～0.3（リアルタイム調整）
- **質量**: 10～200（重い動きの調整）
- **基本摩擦**: 0.90～0.99（減衰の調整）

### 技術仕様

#### 物理システム
- **クォータニオンベース**: ジンバルロック回避で滑らかな回転
- **速度依存制御**: 止まっている時は動きにくく、動いている時は加速しやすい
- **慣性システム**: 質量100、低速域摩擦0.95、高速域は等速度運動
- **軌道半径慣性**: 質量20、摩擦0.9で滑らかなズーム

#### 使用技術
- **レンダリング**: Three.js (r128)
- **地球描画**: SphereGeometry + 高解像度地形テクスチャ
- **人工衛星**: ConeGeometry（緑色の円錐）
- **軌道制御**: クォータニオンベースの軌道制御システム
- **姿勢制御**: setFromUnitVectors でジンバルロック回避

#### ファイル構成
```
ball_attack/
├── index.html          # メインHTML + 物理パラメータUI
├── js/
│   ├── main.js         # ゲームメインロジック + 人工衛星システム
│   ├── controls.js     # 軌道制御・ズーム制御（クォータニオンベース）
│   └── utils.js        # ユーティリティ
├── assets/
│   └── world.topo.bathy.200412.3x5400x2700.jpg  # 地球テクスチャ
└── css/
    └── style.css       # スタイル
```

#### レスポンシブ対応
- スマートフォン・タブレット・PC対応
- タッチ操作（ピンチジェスチャ）とマウス操作の両方サポート
- 画面サイズに応じたUI調整

### 操作ガイド

#### 基本操作
- **ドラッグ**: 軌道上での移動（スクリーンスペース固定の直感的操作）
- **クリック**: 速度を減衰（動きを止めたい時）
- **マウスホイール**: 軌道半径変更（地球に近づく/遠ざかる、高速）
- **ピンチ**: スマホでの軌道半径変更

#### キーボードショートカット
- **F**: 人工衛星位置リセット
- **D**: デバッグモード切り替え
- **R**: ゲームリセット

#### 物理挙動の特徴
- **動き始め**: 重く、反応が鈍い（静止時は特に重い）
- **高速時**: 等速度運動で止まりにくい
- **低速時**: 自動的に摩擦が働いて停止
- **ズーム**: 慣性のある滑らかな半径変更（高速化）
- **操作方向**: どの角度でも一貫したスクリーンスペース操作
- **モード別操作**: 人工衛星モード（上下調整）、カメラモード（左右調整）

### 実装完了内容

#### Phase 1: 基本システム ✅
- Three.jsシーンとレンダラーの基本セットアップ
- 地球オブジェクト（固定位置、高解像度テクスチャ）
- カメラ固定システム（地球にフィット）
- 人工衛星オブジェクト（円錐、仮想軌道球の子として配置）

#### Phase 2: 軌道制御システム ✅
- **仮想軌道球システム**（親子関係による物理的軌道）
- **カメラ座標系ベース回転**（スクリーンスペース固定操作）
- **物理的慣性システム**（質量、摩擦、速度依存制御）
- **等速度運動**（高速時は摩擦なし）
- **低速域自動停止**（一定速度以下で摩擦発生）

#### Phase 3: ズーム制御システム ✅
- **マウスホイール**による軌道半径制御（高速化：3倍速）
- **ピンチジェスチャ**による軌道半径制御
- **慣性システム**による滑らかなズーム
- **制限システム**（最小1.1～最大3.0）

#### Phase 4: 操作性改善 ✅
- **クリック減速**（直感的な停止操作）
- **速度依存感度**（動いている時は加速しやすい）
- **物理パラメータUI**（リアルタイム調整）
- **タッチ操作最適化**（パッシブイベント処理）
- **ドラッグ方向修正**（モード別入力切り替えでシンプル解決）

**技術的特徴**:
- **仮想軌道球システム**: 親子関係による滑らかな軌道制御
- **スクリーンスペース固定操作**: カメラ座標系ベースの直感的操作
- **モード別入力切り替え**: デバッグ/カメラモードで最適化された操作感
- **物理的リアリズム**: 慣性、摩擦、質量による自然な動き
- **直感的操作**: ドラッグで加速、クリックで減速
- **スマホ対応**: ピンチジェスチャとタッチ最適化
- **リアルタイム調整**: 物理パラメータの即座な変更

## 次の実装予定

### Phase 5: カメラモード実装 🚧
人工衛星の位置にカメラを配置する新しいビューモードの実装

#### 実装内容
- **デフォルトモード**: カメラが人工衛星の位置に配置される
  - 現在の人工衛星の軌道位置にカメラを配置
  - カメラは地球の中心を向く（現在の人工衛星と同じ姿勢）
  - ドラッグで軌道移動、ホイール/ピンチで軌道半径変更
  - 同じ物理システム（慣性、等速度運動、低速域摩擦）を使用

- **デバッグモード**: 現在の人工衛星表示モード
  - Dキーでデバッグモード切り替え
  - 人工衛星（緑色の円錐）が表示される
  - カメラは固定位置から人工衛星を観察
  - 開発・デバッグ用として保持

#### 技術仕様
- **モード切り替え**: `debugMode` フラグで制御
- **カメラ制御**: 既存の軌道制御システムを流用
- **視点計算**: 人工衛星位置計算ロジックをカメラ位置に適用
- **姿勢制御**: 人工衛星の地球向き姿勢をカメラに適用

#### UI/UX改善
- **操作説明の更新**: 「人工衛星操作」→「軌道カメラ操作」
- **デバッグモード表示**: 現在のモード状態をUI表示
- **切り替え案内**: Dキーでのモード切り替え方法を説明

#### 実装手順
1. カメラモードとデバッグモードの切り替えシステム
2. カメラ位置・姿勢の軌道制御システム統合
3. 人工衛星表示/非表示の制御
4. UI表示の更新（モード表示、操作説明）
5. テスト・調整（操作感、物理挙動）

**目標**: より没入感のある軌道体験の提供と、デバッグ機能の保持

## 動作環境
- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- WebGL対応必須
- スマートフォン・タブレット対応
- GitHub Pages での静的ホスティング