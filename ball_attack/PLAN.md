# Ball Attack - 実装計画

## 実装ルール
- 終了した実装フェーズは `HISTORY.md` に移動して保存する
- 現在進行中および未実装の内容はこの `PLAN.md` で管理する
- 完了したフェーズは随時HISTORY.mdに移動すること

## 開発計画概要

### 現在の状況
**完了済み**: Phase 1-9 + 基本ゲーム完成 + 親敵・子敵システム + ライフ・ステージシステム実装済み → HISTORY.md に移動済み ✅  
**現在の状態**: **完全なゲームとして動作** - ライフシステム、ステージシステム、ゲームオーバー・クリア画面  
**次期候補**: ゲーム性向上、追加機能、さらなる最適化

### ライフ・ステージシステム実装済み ✅
- **コアゲーム**: 地球シューティングゲームとして完全動作
- **敵システム**: 親敵が子敵を動的配置、エネルギー回復、レーザー攻撃システム
- **ライフシステム**: ハート3つ表示、被弾ダメージ処理、ゲームオーバー画面
- **ステージシステム**: 10ステージ構成、親敵数段階的増加、ステージクリア画面
- **操作性**: PC・スマホ最適化、直感的操作、画面フィット
- **ビジュアル**: 針状弾丸、エフェクト、サウンド統合

---

## 完了済みシステム概要 ✅

### 基盤システム（完了）
- **軌道球カメラシステム**: ジンバルロック回避、画面フィット、タッチ感度調整
- **武器システム**: 針状弾丸、進行方向制御、連続射撃（マウス・タッチ）
- **敵システム**: 300体配置、撃破エフェクト、敵弾丸システム（EnemyAttackSystem）
- **サウンドシステム**: 発射音・爆発音・撃破音のランダム再生
- **操作システム**: PC・スマホ統合、UI要素保護、画面比率対応

### 技術仕様（最新）
- **散らばり**: 調整可能範囲あり
- **ドラッグ感度**: 調整可能範囲あり
- **敵数**: 親敵が動的に子敵を配置（反撃システム付き）
- **弾丸形状**: 針状（進行方向制御）
- **操作方式**: マウスクリック・タッチでの連続射撃

---

## 実装済み: 親敵・子敵システム

### Phase A: 親敵基盤システム（完了） ✅
**目標**: 地球表面を移動する親敵の基本実装

#### 実装完了内容:
1. **ParentEnemySystemクラス**
   - 親敵Aの基本構造（青色球体、子敵の数倍サイズ）
   - 地球表面移動アルゴリズム
   - HP管理システム（高耐久、ダメージ蓄積型）

2. **移動システム**
   - 球面上のランダム移動パターン
   - 地球表面への正確な位置固定
   - 移動速度・パターンの調整機能

3. **UI統合**
   - 親敵HP表示（複数親敵対応）
   - プレイヤーHP表示（初期値設定あり）

### Phase B: 子敵配置システム（完了） ✅
**目標**: 親敵による子敵の動的配置システム

#### 実装完了内容:
1. **配置アルゴリズム**
   - 親敵からの子敵配置機能
   - 配置制約チェック（既存子敵との距離制約）
   - 配置可能位置の検索・決定

2. **既存システム統合**
   - EnemySystemとの連携
   - 子敵生成・管理の移管
   - 配置直後の子敵状態管理

### Phase C: エネルギー・攻撃システム（完了） ✅
**目標**: 親敵の回復・攻撃メカニクス

#### 実装完了内容:
1. **エネルギー回復システム**
   - 子敵からのエネルギー受取（HP回復）
   - 受取条件管理（距離制約、連続受取防止）
   - 回復エフェクト（赤いエミッシブ発光）

2. **レーザー攻撃システム**
   - 青いレーザー柱の実装
   - 人工衛星への攻撃判定（大ダメージ）
   - レーザービジュアル（細いシリンダー）

### Phase D: ステージシステム（完了） ✅
**目標**: ゲームサイクルとステージ進行

#### 実装完了内容:
1. **ステージ管理**
   - ステージシステムの実装
   - 親敵・子敵数の段階的増加
   - ステージクリア条件（全親敵撃破）

2. **ゲームサイクル**
   - 親敵撃破による子敵壊滅
   - ステージ間遷移システム
   - プログレス表示

---

## 従来の実装候補（優先度：低）

### 案A: プレイヤーライフシステム
**目標**: プレイヤーの生存要素を追加し、緊張感のある戦闘を実現

#### 実装内容:
1. **ライフシステム基盤**
   - PlayerLifeSystemクラス（ライフ管理）
   - 敵弾丸との衝突判定システム
   - ダメージエフェクト（画面フラッシュ、カメラシェイク）

2. **ライフUI表示**
   - ハート型アイコンまたは数値表示
   - ダメージ時のアニメーション
   - ゲームオーバー画面・リスタート機能

**実装済み**: EnemyAttackSystem（敵弾丸システム）は完成済み ✅

### 案B: ゲーム性向上
**目標**: より戦略的で楽しいゲームプレイ

#### 実装内容:
1. **スコアシステム強化**
   - 連続撃破ボーナス
   - 時間ボーナス
   - ハイスコア記録・表示

2. **敵の多様化**
   - 異なるサイズの敵（小・中・大）
   - 異なる耐久力・攻撃パターン
   - 特殊敵（高速移動、強攻撃等）

### 案C: ビジュアル・UX向上
**目標**: より洗練されたゲーム体験

#### 実装内容:
1. **エフェクト強化**
   - 撃破時のより派手なエフェクト
   - 背景・地球のビジュアル改善
   - UI・メニューの改善

2. **操作性向上**
   - 追加の操作オプション
   - アクセシビリティ機能
   - パフォーマンス最適化

---

## 将来のアイデア

### 長期的拡張案

#### 案D: 動的敵システム
**目標**: より動的で挑戦的なゲームプレイ

1. **敵移動システム**
   - 球面移動アルゴリズム
   - 多様な移動パターン（直線、ジグザグ、群れ）
   - 地形に応じた速度変化

2. **敵AI・行動システム**
   - 弾丸回避行動
   - 予測回避アルゴリズム
   - 敵の増殖・分裂システム

#### 案E: 高度なゲームメカニクス
**目標**: 長期的なゲーム体験

1. **敵種別システム**
   - 小型・大型・ボス敵
   - 特殊能力（シールド、分裂、テレポート）
   - 敵タイプ別の戦略性

2. **ウェーブシステム**
   - 段階的難易度上昇
   - ステージ進行システム
   - プレイヤー武器強化

---

## 技術仕様詳細

### 現在のファイル構成
```
ball_attack/
├── js/
│   ├── main.js          ✅ # ゲーム統合、画面フィット、UI要素判定
│   ├── controls.js      ✅ # カメラ制御、タッチ感度調整
│   ├── weapons.js       ✅ # プレイヤー武器、針状弾丸
│   ├── enemies.js       ✅ # 敵システム、撃破エフェクト
│   ├── enemy-attack.js  ✅ # 敵攻撃システム（実装済み）
│   ├── sound.js         ✅ # サウンドシステム
│   └── utils.js         ✅ # ユーティリティ
├── README.md            ✅ # プロジェクト概要
├── HISTORY.md           ✅ # 開発履歴
└── PLAN.md              ✅ # 実装計画（このファイル）
```

### パフォーマンス実績
- **フレームレート**: 高フレームレート維持達成
- **メモリ使用量**: 軽量設計完成
- **反応性**: リアルタイム操作・エフェクト

## 次期実装計画（今後の拡張機能）

### 次のステップ（推奨実装順序）

**従来の拡張機能**:
1. プレイヤーライフシステム（案A）
2. スコアシステム強化（案B）
3. ビジュアル向上（案C）
4. 動的敵システム（案D）
5. 高度なメカニクス（案E）

**実装方針**: 親敵・子敵システムの実装が完了し、さらなるゲーム性向上やビジュアル改善を検討