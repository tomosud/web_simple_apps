# Ball Attack - 実装計画

## 実装ルール
- 終了した実装フェーズは `HISTORY.md` に移動して保存する
- 現在進行中および未実装の内容はこの `PLAN.md` で管理する
- 完了したフェーズは随時HISTORY.mdに移動すること

## 開発計画概要

### 現在の状況
**完了済み**: Phase 1-3（カメラ・弾丸・サウンドシステム）→ HISTORY.md に移動済み ✅  
**現在のフェーズ**: **攻撃ゲームフェーズ1** - 静的な敵との攻撃戦闘システム  
**将来の目標**: 動的な敵システム、増殖システム、高度なゲームメカニクス

---

## 攻撃ゲーム実装計画

### 攻撃ゲームフェーズ1: 静的ターゲットシステム (実装中)
**目標**: 地球表面に配置された200個の赤い点を攻撃するシューティングゲーム

#### フェーズ1-1: 敵配置システム (未実装)
**実装タスク**:
1. **EnemySystemクラス設計**
   ```javascript
   class EnemySystem {
     constructor(scene, earthRadius)
     generateEnemies(count = 200)
     checkCollisions(attackSpheres)
     removeEnemy(enemyId)
     getActiveEnemyCount()
   }
   ```

2. **敵オブジェクト仕様**
   - **形状**: 小さな赤色スフィア（半径0.01）
   - **配置**: 地球表面にランダム配置（200個）
   - **位置**: 緯度経度ベースで地表に吸着
   - **材質**: MeshStandardMaterial（赤色、エミッシブ対応）

3. **配置アルゴリズム**
   - ランダム緯度経度生成（-90°〜90°, -180°〜180°）
   - 地表からわずかに浮上（半径+0.005）
   - 重複回避（最小距離0.05以上）
   - 海域・陸域関係なく均等配置

#### フェーズ1-2: 衝突判定システム (未実装)
**実装タスク**:
1. **弾丸-敵衝突判定**
   - 攻撃判定球と敵スフィアの距離計算
   - 致死ダメージ判定（中心100%、境界20%）
   - 確率的撃破システム

2. **撃破エフェクト**
   - 敵消失アニメーション（スケール0への縮小）
   - 撃破時の小爆発エフェクト
   - 撃破音再生（impact音の音程変更版）

3. **オブジェクト管理**
   - 撃破された敵の削除
   - 残り敵数のリアルタイム更新
   - メモリリーク防止

#### フェーズ1-3: ゲーム進行システム (未実装)
**実装タスク**:
1. **スコアリングシステム**
   - 敵撃破時のスコア加算（1体=100点）
   - 連続撃破ボーナス（5連続で2倍）
   - 精密射撃ボーナス（中心命中で1.5倍）

2. **UI統合**
   - 残り敵数表示（200→199→...→0）
   - リアルタイムスコア表示
   - 撃破率表示（撃破数/発射弾数）

3. **ゲーム終了条件**
   - 全敵撃破でクリア
   - クリア時間の記録
   - リスタート機能

#### フェーズ1-4: パフォーマンス最適化 (未実装)
**実装タスク**:
1. **レンダリング最適化**
   - InstancedMeshによる敵の一括描画
   - フラスタムカリング（画面外の敵を描画除外）
   - LODシステム（距離に応じて詳細度調整）

2. **衝突判定最適化**
   - 空間分割による効率的な判定
   - 最大判定数制限（1フレーム10個まで）
   - 距離ソートによる優先判定

---

### 攻撃ゲームフェーズ2: 動的敵システム (将来実装)
**目標**: 地球表面を移動する敵との動的戦闘

#### フェーズ2-1: 敵移動システム
**実装予定**:
1. **球面移動アルゴリズム**
   - 大円経路による自然な移動
   - ランダムウォーク + 方向転換
   - 地形に応じた速度変化

2. **移動パターン**
   - 直線移動型（速度0.01/秒）
   - ジグザグ移動型（回避行動）
   - 群れ移動型（複数敵の連携）

#### フェーズ2-2: 敵AI・行動システム
**実装予定**:
1. **回避行動**
   - 弾丸接近感知
   - 予測回避アルゴリズム
   - 地形を利用した隠蔽

2. **増殖システム**
   - 時間経過による敵分裂
   - 撃破されない敵の自己複製
   - 最大敵数制限（300体）

---

### 攻撃ゲームフェーズ3: 高度なゲームメカニクス (将来実装)
**目標**: 本格的なゲーム要素の追加

#### フェーズ3-1: 敵種別システム
**実装予定**:
1. **敵タイプ多様化**
   - 小型敵（高速移動、低耐久）
   - 大型敵（低速移動、高耐久）
   - ボス敵（特殊攻撃、大量HP）

2. **特殊能力**
   - シールド敵（一定時間無敵）
   - 分裂敵（撃破時に2体に分裂）
   - テレポート敵（瞬間移動）

#### フェーズ3-2: ウェーブシステム
**実装予定**:
1. **ステージ進行**
   - Wave 1: 200体の静的敵
   - Wave 2: 100体の移動敵
   - Wave 3: 50体の高速敵 + ボス1体

2. **難易度調整**
   - ウェーブごとの敵数増加
   - 敵速度・耐久力の向上
   - プレイヤー武器強化システム

---

## 技術仕様詳細

### 座標系統一（継続）
- **地球**: 中心 (0, 0, 0)、半径 1
- **敵配置**: 地球表面 + 0.005のオフセット
- **攻撃判定**: 3D空間での球体-球体衝突

### ファイル構成（更新予定）
```
ball_attack/
├── js/
│   ├── main.js          ✅ # 既存
│   ├── controls.js      ✅ # 既存
│   ├── weapons.js       ✅ # 既存
│   ├── sound.js         ✅ # 既存
│   ├── utils.js         ✅ # 既存
│   ├── enemies.js        # 新規：EnemySystemクラス
│   ├── collision.js      # 新規：衝突判定システム
│   └── game-logic.js     # 新規：ゲーム進行ロジック
```

### 実装優先順位
1. **最優先**: フェーズ1-1（敵配置システム）
2. **高優先**: フェーズ1-2（衝突判定システム）
3. **中優先**: フェーズ1-3（ゲーム進行システム）
4. **低優先**: フェーズ1-4（パフォーマンス最適化）

### パフォーマンス目標
- **フレームレート**: 60fps維持（敵200体 + 弾丸50発同時）
- **メモリ使用量**: 100MB以下
- **初期化時間**: 3秒以内
- **レスポンシブ対応**: PC・スマホ・タブレット全対応

---

## 次のステップ
1. `js/enemies.js` の作成
2. EnemySystemクラスの実装
3. main.jsへの敵システム統合
4. 衝突判定機能の追加
5. UI表示の更新